---

- name: Create jenkins scripts dir
  file:
    path:  "{{ jenkins_scripts_dir }}"
    owner: "{{ jenkins_user }}"
    group: "{{ jenkins_group }}"
    mode:  0755
    state: directory

- name: Copy jenkins config helper scripts
  copy:
    src:   "{{ item }}"
    dest:  "{{ jenkins_scripts_dir }}"
    owner: "{{ jenkins_user }}"
    group: "{{ jenkins_group }}"
    mode:  0644
  with_items:
    - cli_helper.groovy
    - grant_global_matrix_permissions.groovy

- name: Extract jenkins-cli.jar
  shell: >
      jar -xf /usr/share/jenkins/jenkins.war WEB-INF/jenkins-cli.jar &&
          mv WEB-INF/jenkins-cli.jar ./ &&
          rm -rf WEB-INF &&
          chown {{ jenkins_user }}: jenkins-cli.jar
  args:
    chdir:   "{{ jenkins_scripts_dir }}"
    creates: "{{ jenkins_scripts_dir }}/jenkins-cli.jar"
